var dataLayer=dataLayer||[{}];Cohorts=function(){var t={debug:!0},e={USER:"user",SESSION:"session",HIT:"hit"},o={HREF:"href",PATHNAME:"pathname"},i={nameSpace:"experiments",onInitialize:function(t,e,o,i,n,r){var s="testSlot"+i,a={};a[s]=e+" "+o,dataLayer.push(a),dataLayer.push({event:"experiment",nameSpace:this.nameSpace,testName:e,cohort:o,testScope:n,newToTest:r})},onEvent:function(t,e){dataLayer.push({event:"event",eventCategory:this.nameSpace,eventAction:t,eventLabel:e,eventProperty:scope,eventValue:1,eventNonInt:!1})}},n=function(){var t="_cohorts",n=function(t){if(this.options=r.extend({name:null,cohorts:null,testScope:e.USER,analyticsSlot:null,sampleRate:1,storageAdapter:null},t),this.cohorts=r.keys(this.options.cohorts),null===this.options.name)throw"A name for this test must be specified";if(null===this.options.cohorts)throw"Cohorts must be specified for this test";if(this.cohorts.length<2)throw"You must specify at least 2 cohorts for a test";this.options.analyticsSlot||(this.options.analyticsSlot=5),this.options.storageAdapter||(this.options.storageAdapter=i),this.run()};return n.prototype={run:function(){var t=window.location.hash,e=!1;0==t.indexOf("#")&&(t=t.slice(1,t.length));for(var o=t.split("&"),i=0;i<o.length;i++){var n=o[i].split("="),s=n[0],a=n[1];this.options.name==s&&(r.log("Forcing test "+s+" into cohort "+a),this.setCohort(a),e=!0)}var h=this.inTest(),c=this.isExecutable(),l=!1,f=!1;if(null!==h||c)if(null===h&&c&&(h=Math.random()<=this.options.sampleRate,h?l=!0:f=!0),h||e){r.log("Test Object ["+this.options.name+"] run."),this.setCookie("in_test",1);var u,p=this.getCohort();p?u=p:(u=this.chooseCohort(),this.setCohort(u)),this.options.storageAdapter.onInitialize(h,this.options.name,u,this.options.analyticsSlot,this.options.testScope,l);var d=this.options.cohorts[u];if(d.redirectTo&&c){var m=d.redirectTo;if(r.isFunction(d.redirectTo)&&(m=m()),m&&m.indexOf(window.location.href)<0)return void(window.location.href=m)}if(d.onChosen&&c)if(this.options.runNow)r.log("Test Object ["+this.options.name+"] cohort onChosen ["+u+"] run."),d.onChosen();else{var v=this;Cohorts.domReady(function(){r.log("Test Object ["+v.options.name+"] cohort onChosen ["+u+"] run."),d.onChosen()})}}else f&&this.setCookie("in_test",0)},event:function(t){this.inTest()&&this.options.storageAdapter.onEvent(this.options.name,this.getCohort(),t)},isExecutable:function(){var t=this.targetURLMatch();if(!t)return r.log("Test Object ["+this.options.name+"] targetURL not matched."),!1;var e=this.options.userAgentExclude?h.match(this.options.userAgentExclude):!1;if(e)return r.log("Test Object ["+this.options.name+"] user agent blocked."),!1;var o=this.cookieMatch();if(!o)return r.log("Test Object ["+this.options.name+"] cookie not matched."),!1;var i=this.referrerMatch();return i?!0:(r.log("Test Object ["+this.options.name+"] referrer not matched."),!1)},targetURLMatch:function(){var t=this.options.targetURL,e=!1;if(!t)return!0;if(t.length<=0)return!0;for(var i=0,n=t.length;n>i;i++){var s,a=t[i],h=0;if(r.isObject(a)&&!a.test?(s=a.expression,h=null==a.match?o.HREF:a.match):s=a,e=s.test(h.toLowerCase()==o.HREF?document.location.href:document.location.pathname))break}return e},cookieMatch:function(){var t=this.options.cookieMatch;if(!t)return!0;var e=s.parseCookies();if(r.isFunction(t))return t(e);if(t.length<=0)return!0;for(var o=!1,i=0,n=t.length;n>i;i++){var a=t[i],h=0,c=0;for(var l in a){if(c++,null==e[l])break;if(e[l]!=a[l])break;h++}if(h==c){o=!0;break}}return o},referrerMatch:function(){var t=this.options.referrerMatch;if(!t)return!0;if(t.length<=0)return!0;if(r.isFunction(t))return t(document.referrer);for(var e=document.referrer,o=!1,i=0,n=t.length;n>i;i++)if(e==t[i]){o=!0;break}return o},chooseCohort:function(){var t,e=this.options.cohorts,o=!0;for(var i in e)if(null==e[i].sampleRate){o=!1;break}if(o)for(var n=function(){return Math.random()},r=this.getOrderedBySampleCohorts(),s=0,a=r[r.length-1].sampleRate;!t;){s=n();for(var h=0;h<r.length;h++)if(s<=r[h].sampleRate){t=r[h].key;break}!t&&1-a>=s-a&&(t=r[r.length-1].key)}else{var c=1/this.cohorts.length,l=Math.floor(Math.random()/c);t=this.cohorts[l]}return t},getOrderedBySampleCohorts:function(){var t=this.options.cohorts,e=[];for(var o in t)e.push({key:o,sampleRate:t[o].sampleRate});return e.sort(function(t,e){return t.sampleRate-e.sampleRate}),e},inTest:function(){var t=this.getCookie("in_test");return null==t?null:1==t},getCohort:function(){return this.inTest()?this.getCookie("chosen_cohort"):null},setCohort:function(t){return-1==r.arrayIndexOf(this.cohorts,t)?!1:(this.setCookie("chosen_cohort",t),!0)},setCookie:function(e,o,i){s.set(t+"_"+this.options.name+"_"+e,o,i,this.options.testScope)},getCookie:function(e){return s.get(t+"_"+this.options.name+"_"+e)}},n}(),r={extend:function(t,e){for(var o in e)t[o]=e[o];return t},keys:function(t){var e=[];for(var o in t)e.push(o);return e},log:function(e){window.console&&t.debug&&(console.log?console.log(e):alert(e))},isObject:function(t){return void 0!==t&&(null===t||"object"==typeof t)},isFunction:function(t){var e=Object.prototype.toString;return"[object Function]"===e.call(t)},arrayIndexOf:function(t,e){if(Array.prototype.indexOf)return t.indexOf(e);for(var o=-1,i=0,n=t.length;n>i;i++)if(t[i]==e){o=i;break}return o}},s={parseCookies:function(){var t,e,o,i,n={},r=document.cookie.split(";"),s=r.length;for(t=0;s>t;t++)e=r[t].split("="),o=e[0].replace(/^\s*/,"").replace(/\s*$/,""),i=decodeURIComponent(e[1])||null,n[o]=i;return n},get:function(t){var e,o=document.cookie,i=o.match(new RegExp("(?:^|; )"+this.escapeString(t)+"=([^;]*)"));return e=i?decodeURIComponent(i[1]):null},set:function(t,o,i,n){i=i||{},i.path||(i.path="/");var r,s=i.expires;"number"==typeof s?(r=new Date,r.setTime(r.getTime()+24*s*60*60*1e3),s=i.expires=r):n.toLowerCase()===e.USER&&(r=new Date,r.setTime(r.getTime()+63072e6),s=i.expires=r),s&&s.toUTCString&&(i.expires=s.toUTCString()),o=encodeURIComponent(o);var a,h=t+"="+o;for(a in i){h+="; "+a;var c=i[a];c!==!0&&(h+="="+c)}document.cookie=h},escapeString:function(t){return t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(t){return"\\"+t})}},a=function(){function t(){var t=s;if(a&&t.length){var e;for(e=0;e<s.length;e+=1)s[e]();s=[]}}function e(){a||(a=!0,i&&clearInterval(i),t())}function o(t){return a?t():s.push(t),o}var i,n,r,s=[],a=!1;if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1);else if(window.attachEvent){document.attachEvent("onreadystatechange",function(){("interactive"==document.readyState||"complete"==document.readyState||"loaded"==document.readyState)&&e("readaySate")}),window.attachEvent("onload",e),n=document.documentElement;try{r=null===window.frameElement}catch(h){}n.doScroll&&r&&window.external&&(i=setInterval(function(){try{n.doScroll(),e("ie hack")}catch(t){}},2))}return"complete"===document.readyState&&e(),o}(),h={initialized:!1,init:function(){var t=navigator,e=t.userAgent,o=t.appVersion,i=parseFloat(o);if(this.webkit=parseFloat(e.split("WebKit/")[1])||void 0,this.khtml=o.indexOf("Konqueror")>=0?i:void 0,this.mac=o.indexOf("Macintosh")>=0,this.ios=/iPhone|iPod|iPad/.test(e),this.android=parseFloat(e.split("Android ")[1])||void 0,this.bb=e.indexOf("BlackBerry")>=0||e.indexOf("BB10")>=0?parseFloat(e.split("Version/")[1])||void 0:void 0,this.chrome=parseFloat(e.split("Chrome/")[1])||void 0,this.safari=o.indexOf("Safari")>=0&&!this.chrome?parseFloat(o.split("Version/")[1]):void 0,this.chrome&&(this.chrome=Math.floor(this.chrome)),this.safari&&(this.safari=Math.floor(this.safari)),this.bb&&(this.bb=Math.floor(this.bb)),!this.webkit&&(e.indexOf("Opera")>=0&&(this.opera=i>=9.8?parseFloat(e.split("Version/")[1])||i:i,this.opera=Math.floor(this.opera)),e.indexOf("Gecko")>=0&&!this.khtml&&!this.webkit&&(this.mozilla=i),this.mozilla&&(this.ff=parseFloat(e.split("Firefox/")[1]||e.split("Minefield/")[1])||void 0,this.ff&&(this.ff=Math.floor(this.ff))),document.all&&!this.opera)){var n=parseFloat(o.split("MSIE ")[1])||void 0,r=document.documentMode;r&&5!=r&&Math.floor(n)!=r&&(n=r),this.ie=n}if(e.match(/(iPhone|iPod|iPad)/)){var s=RegExp.$1.replace(/P/,"p"),a=e.match(/OS ([\d_]+)/)?RegExp.$1:"1",h=parseFloat(a.replace(/_/,".").replace(/_/g,""));this[s]=h}this.initialized=!0},match:function(t){if(this.initialized||this.init(),!t)return!1;if(t.length<=0)return!1;for(var e=!0,o=0,i=t.length;i>o;o++){var n=t[o];if(r.isObject(n)){for(var s in n)if(this[s]){for(var a=n[s],h=0,c=a.length;c>h;h++)if(this[s]==a[h]){e=!0;break}if(e)break}}else e=this[n];if(e)break}return void 0===e?!1:e}};return{Test:n,Cookies:s,Options:t,domReady:a,userAgent:h}}();